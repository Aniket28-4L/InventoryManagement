{"ast":null,"code":"import { BehaviorSubject, tap } from 'rxjs';\nimport { Router } from '@angular/router';\nimport { ApiService } from './api.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./api.service\";\nimport * as i2 from \"@angular/router\";\nexport class AuthService {\n  constructor(api, router) {\n    this.api = api;\n    this.router = router;\n    this.tokenKey = 'token';\n    this.tokenSubject = new BehaviorSubject(sessionStorage.getItem(this.tokenKey));\n    this.userSubject = new BehaviorSubject(null);\n    this.loadingSubject = new BehaviorSubject(false);\n    this.token$ = this.tokenSubject.asObservable();\n    this.user$ = this.userSubject.asObservable();\n    this.loading$ = this.loadingSubject.asObservable();\n  }\n  get token() {\n    return this.tokenSubject.value;\n  }\n  get user() {\n    return this.userSubject.value;\n  }\n  get role() {\n    return this.user?.role ?? 'Viewer';\n  }\n  bootstrap() {\n    const token = this.tokenSubject.value;\n    if (!token) {\n      this.loadingSubject.next(false);\n      return;\n    }\n    this.loadingSubject.next(true);\n    this.api.get('/auth/me').subscribe({\n      next: res => {\n        if (res?.success) {\n          this.userSubject.next(res.user);\n        } else {\n          this.clearAuth();\n        }\n        this.loadingSubject.next(false);\n      },\n      error: () => {\n        this.clearAuth();\n        this.loadingSubject.next(false);\n      }\n    });\n  }\n  login(email, password) {\n    this.loadingSubject.next(true);\n    return this.api.post('/auth/login', {\n      email,\n      password\n    }).pipe(tap({\n      next: res => {\n        if (res.success) {\n          sessionStorage.setItem(this.tokenKey, res.token);\n          this.tokenSubject.next(res.token);\n          this.userSubject.next(res.user);\n          this.router.navigateByUrl('/');\n        }\n        this.loadingSubject.next(false);\n      },\n      error: () => this.loadingSubject.next(false)\n    }));\n  }\n  logout() {\n    this.api.post('/auth/logout', {}).subscribe({\n      error: () => {}\n    });\n    this.clearAuth();\n    this.router.navigate(['/login']);\n  }\n  setUser(user) {\n    this.userSubject.next(user);\n  }\n  clearAuth() {\n    sessionStorage.removeItem(this.tokenKey);\n    this.tokenSubject.next(null);\n    this.userSubject.next(null);\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ɵɵinject(i1.ApiService), i0.ɵɵinject(i2.Router));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}