{"ast":null,"code":"import _asyncToGenerator from \"F:/REACT PROJECT/IM/IM/InventoryManagement/frontend/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Router } from '@angular/router';\nimport { ToastrService } from 'ngx-toastr';\nimport { ApiService } from '../../../core/services/api.service';\nimport { ProductsService } from '../../../core/services/products.service';\nimport { environment } from '../../../../environments/environment';\nimport { Html5Qrcode, Html5QrcodeSupportedFormats } from 'html5-qrcode';\nimport { WarehouseService } from '../../../core/services/warehouse.service';\nimport { CatalogService } from '../../../core/services/catalog.service';\nimport { StockTransferService } from '../../../core/services/stock-transfer.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../core/services/api.service\";\nimport * as i2 from \"../../../core/services/products.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"ngx-toastr\";\nimport * as i5 from \"../../../core/services/warehouse.service\";\nimport * as i6 from \"../../../core/services/catalog.service\";\nimport * as i7 from \"../../../core/services/stock-transfer.service\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"@angular/forms\";\nimport * as i10 from \"../../../shared/components/spinner/spinner.component\";\nimport * as i11 from \"../../../shared/components/lucide-icon/lucide-icon.component\";\nconst _c0 = (a0, a1) => ({\n  \"text-gray-600\": a0,\n  \"text-green-700\": a1\n});\nfunction BarcodeScanComponent_option_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const cam_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", cam_r1.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(cam_r1.label || cam_r1.id);\n  }\n}\nfunction BarcodeScanComponent_span_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Scanning\\u2026\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BarcodeScanComponent_span_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"Scan successful\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BarcodeScanComponent_button_23_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function BarcodeScanComponent_button_23_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.clearScan());\n    });\n    i0.ɵɵelement(1, \"lucide-icon\", 22);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BarcodeScanComponent_div_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 23);\n    i0.ɵɵelement(1, \"app-spinner\", 24);\n    i0.ɵɵelementStart(2, \"span\", 25);\n    i0.ɵɵtext(3, \"Searching for product...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction BarcodeScanComponent_div_27_option_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const w_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", w_r5.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(w_r5.name || w_r5.code);\n  }\n}\nfunction BarcodeScanComponent_div_27_div_35_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const w_r7 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", w_r7.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(w_r7.name || w_r7.code);\n  }\n}\nfunction BarcodeScanComponent_div_27_div_35_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"label\", 29);\n    i0.ɵɵtext(2, \"To Warehouse\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"select\", 6);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function BarcodeScanComponent_div_27_div_35_Template_select_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r2.toWarehouseId, $event) || (ctx_r2.toWarehouseId = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementStart(4, \"option\", 33);\n    i0.ɵɵtext(5, \"Select destination warehouse\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, BarcodeScanComponent_div_27_div_35_option_6_Template, 2, 2, \"option\", 7);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r2.toWarehouseId);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.warehouses);\n  }\n}\nfunction BarcodeScanComponent_div_27_div_36_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const s_r9 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", s_r9.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(s_r9.name);\n  }\n}\nfunction BarcodeScanComponent_div_27_div_36_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"label\", 29);\n    i0.ɵɵtext(2, \"To Store\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"select\", 6);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function BarcodeScanComponent_div_27_div_36_Template_select_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r2.toStoreId, $event) || (ctx_r2.toStoreId = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementStart(4, \"option\", 33);\n    i0.ɵɵtext(5, \"Select destination store\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, BarcodeScanComponent_div_27_div_36_option_6_Template, 2, 2, \"option\", 7);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r2.toStoreId);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.stores);\n  }\n}\nfunction BarcodeScanComponent_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 26)(2, \"h2\", 27);\n    i0.ɵɵtext(3, \"Transfer Stock\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 28)(5, \"div\")(6, \"label\", 29);\n    i0.ɵɵtext(7, \"Product\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"p\", 30);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementStart(10, \"span\", 31);\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(12, \"div\")(13, \"label\", 29);\n    i0.ɵɵtext(14, \"Quantity\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"input\", 32);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function BarcodeScanComponent_div_27_Template_input_ngModelChange_15_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r2.quantity, $event) || (ctx_r2.quantity = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\")(17, \"label\", 29);\n    i0.ɵɵtext(18, \"From Warehouse\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"select\", 6);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function BarcodeScanComponent_div_27_Template_select_ngModelChange_19_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r2.fromWarehouseId, $event) || (ctx_r2.fromWarehouseId = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementStart(20, \"option\", 33);\n    i0.ɵɵtext(21, \"Select source warehouse\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(22, BarcodeScanComponent_div_27_option_22_Template, 2, 2, \"option\", 7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(23, \"div\")(24, \"label\", 29);\n    i0.ɵɵtext(25, \"Transfer Type\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"div\", 34)(27, \"label\", 35)(28, \"input\", 36);\n    i0.ɵɵlistener(\"ngModelChange\", function BarcodeScanComponent_div_27_Template_input_ngModelChange_28_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.transferType = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"span\");\n    i0.ɵɵtext(30, \"Warehouse\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(31, \"label\", 35)(32, \"input\", 37);\n    i0.ɵɵlistener(\"ngModelChange\", function BarcodeScanComponent_div_27_Template_input_ngModelChange_32_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.transferType = $event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"span\");\n    i0.ɵɵtext(34, \"Store\");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵtemplate(35, BarcodeScanComponent_div_27_div_35_Template, 7, 2, \"div\", 12)(36, BarcodeScanComponent_div_27_div_36_Template, 7, 2, \"div\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(37, \"div\", 38)(38, \"button\", 39);\n    i0.ɵɵlistener(\"click\", function BarcodeScanComponent_div_27_Template_button_click_38_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.confirmTransfer());\n    });\n    i0.ɵɵtext(39, \"Confirm Transfer\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(40, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function BarcodeScanComponent_div_27_Template_button_click_40_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.clearScan());\n    });\n    i0.ɵɵtext(41, \"Clear\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r2.product.name, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"(\", ctx_r2.product.sku, \")\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r2.quantity);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r2.fromWarehouseId);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.warehouses);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngModel\", ctx_r2.transferType);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r2.transferType);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.transferType === \"warehouse\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.transferType === \"store\");\n  }\n}\nfunction BarcodeScanComponent_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 40)(1, \"p\");\n    i0.ɵɵtext(2, \"No product found for barcode: \");\n    i0.ɵɵelementStart(3, \"strong\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"p\", 41);\n    i0.ɵɵtext(6, \"Make sure the barcode is correct and the product exists in the system.\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r2.scannedBarcode);\n  }\n}\nexport class BarcodeScanComponent {\n  constructor(api, productsService, router, toastr, warehouseService, catalogService, stockTransferService) {\n    this.api = api;\n    this.productsService = productsService;\n    this.router = router;\n    this.toastr = toastr;\n    this.warehouseService = warehouseService;\n    this.catalogService = catalogService;\n    this.stockTransferService = stockTransferService;\n    this.scannedBarcode = '';\n    this.product = null;\n    this.loading = false;\n    this.isMobile = false;\n    this.isRedirecting = false;\n    this.scanActive = false;\n    this.scanSuccess = false;\n    this.preventMultiple = false;\n    this.availableCameras = [];\n    this.cameraId = '';\n    this.transferType = 'warehouse';\n    this.warehouses = [];\n    this.stores = [];\n    this.scannedUrl = '';\n    this.fromWarehouseId = '';\n    this.toWarehouseId = '';\n    this.toStoreId = '';\n    this.quantity = '';\n  }\n  ngOnInit() {\n    // Detect mobile device\n    this.isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n    this.prepareScanner();\n    this.loadWarehousesAndStores();\n  }\n  ngOnDestroy() {\n    if (this.inputTimeout) {\n      clearTimeout(this.inputTimeout);\n    }\n    this.stopScanning();\n  }\n  onBarcodeInput(value) {\n    this.scannedBarcode = value;\n    // Clear previous timeout\n    if (this.inputTimeout) {\n      clearTimeout(this.inputTimeout);\n    }\n    // Wait for user to finish typing (debounce)\n    this.inputTimeout = setTimeout(() => {\n      if (value && value.trim().length > 0) {\n        this.scanBarcode(value.trim());\n      }\n    }, 500);\n  }\n  prepareScanner() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const cams = yield Html5Qrcode.getCameras();\n        _this.availableCameras = cams || [];\n        _this.cameraId = _this.availableCameras[0]?.id || '';\n      } catch {}\n    })();\n  }\n  startScanning() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      if (_this2.scanActive) return;\n      _this2.scanSuccess = false;\n      _this2.preventMultiple = false;\n      try {\n        _this2.html5Qr = new Html5Qrcode('qr-reader', {\n          verbose: false\n        });\n        const config = {\n          fps: 10,\n          qrbox: {\n            width: 300,\n            height: 300\n          },\n          formatsToSupport: [Html5QrcodeSupportedFormats.CODE_128, Html5QrcodeSupportedFormats.QR_CODE],\n          disableFlip: true\n        };\n        _this2.scanActive = true;\n        yield _this2.html5Qr.start(_this2.cameraId ? _this2.cameraId : {\n          facingMode: 'environment'\n        }, config, decodedText => {\n          if (_this2.preventMultiple) return;\n          _this2.preventMultiple = true;\n          _this2.scanSuccess = true;\n          _this2.scannedBarcode = decodedText;\n          _this2.stopScanning();\n          _this2.scanBarcode(decodedText);\n        }, () => {});\n      } catch (err) {\n        _this2.scanActive = false;\n        _this2.toastr.error(err?.message || 'Unable to start camera');\n      }\n    })();\n  }\n  stopScanning() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        if (_this3.html5Qr && _this3.scanActive) {\n          yield _this3.html5Qr.stop();\n          yield _this3.html5Qr.clear();\n        }\n      } catch {}\n      _this3.scanActive = false;\n    })();\n  }\n  changeCamera(id) {\n    this.cameraId = id;\n    if (this.scanActive) {\n      this.stopScanning().then(() => this.startScanning());\n    }\n  }\n  scanBarcode(barcode) {\n    if (!barcode) {\n      this.toastr.error('Please enter or scan a barcode');\n      return;\n    }\n    // If QR contains a URL, open it immediately (stock transfer flow)\n    if (barcode.startsWith('http://') || barcode.startsWith('https://')) {\n      window.location.href = barcode;\n      return;\n    }\n    // Otherwise route to Stock Transfer page with SKU\n    this.router.navigate(['/stock/transfer'], {\n      queryParams: {\n        sku: barcode\n      }\n    });\n  }\n  redirectToProductPdf(productId) {\n    // Fallback to product detail page\n    this.router.navigate(['/products', productId]);\n  }\n  openPdf() {\n    if (this.product?.pdfUrl) {\n      const apiBaseUrl = environment.apiUrl.replace('/api', ''); // Remove /api since pdfUrl already includes it\n      const pdfUrl = this.product.pdfUrl.startsWith('http') ? this.product.pdfUrl : `${apiBaseUrl}${this.product.pdfUrl}`;\n      window.open(pdfUrl, '_blank');\n    }\n  }\n  viewProductDetails() {\n    if (this.product?.id) {\n      this.router.navigate(['/products', this.product.id]);\n    }\n  }\n  clearScan() {\n    this.scannedBarcode = '';\n    this.product = null;\n    this.scanSuccess = false;\n    this.scannedUrl = '';\n    this.fromWarehouseId = '';\n    this.toWarehouseId = '';\n    this.toStoreId = '';\n    this.quantity = '';\n    this.transferType = 'warehouse';\n  }\n  confirmTransfer() {\n    if (!this.product?.id) {\n      this.toastr.error('No product selected');\n      return;\n    }\n    const qtyNum = parseInt(String(this.quantity), 10);\n    if (!Number.isInteger(qtyNum) || qtyNum < 1) {\n      this.toastr.error('Enter a valid quantity');\n      return;\n    }\n    if (!this.fromWarehouseId) {\n      this.toastr.error('Select source warehouse');\n      return;\n    }\n    if (this.transferType === 'store') {\n      if (!this.toStoreId) {\n        this.toastr.error('Select destination store');\n        return;\n      }\n      const payload = {\n        productId: this.product.id,\n        fromWarehouse: this.fromWarehouseId,\n        storeId: this.toStoreId,\n        qty: qtyNum\n      };\n      this.warehouseService.transferToStore(payload).subscribe({\n        next: () => {\n          this.toastr.success('Transferred to store');\n          this.clearScan();\n        },\n        error: error => {\n          const backendMsg = error?.error?.message || error?.error?.errors?.[0]?.msg;\n          this.toastr.error(backendMsg || error?.message || 'Transfer failed');\n        }\n      });\n    } else {\n      if (!this.toWarehouseId) {\n        this.toastr.error('Select destination warehouse');\n        return;\n      }\n      if (this.toWarehouseId === this.fromWarehouseId) {\n        this.toastr.error('Source and destination cannot be same');\n        return;\n      }\n      const payload = {\n        fromWarehouse: this.fromWarehouseId,\n        toWarehouse: this.toWarehouseId,\n        items: [{\n          product: this.product.id,\n          sku: this.product.sku || '',\n          quantity: qtyNum,\n          notes: ''\n        }],\n        notes: ''\n      };\n      this.stockTransferService.create(payload).subscribe({\n        next: () => {\n          this.toastr.success('Transferred to warehouse');\n          this.clearScan();\n        },\n        error: error => {\n          const backendMsg = error?.error?.message || error?.error?.errors?.[0]?.msg;\n          this.toastr.error(backendMsg || error?.message || 'Transfer failed');\n        }\n      });\n    }\n  }\n  loadWarehousesAndStores() {\n    this.warehouseService.list({\n      limit: 1000\n    }).subscribe({\n      next: res => {\n        this.warehouses = res.warehouses || [];\n      },\n      error: () => {}\n    });\n    this.catalogService.listStores().subscribe({\n      next: stores => {\n        this.stores = stores || [];\n      },\n      error: () => {}\n    });\n  }\n  findProductByCode(code) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const res = yield _this4.api.get(`/barcodes/scan?barcode=${encodeURIComponent(code)}`).toPromise();\n        if (res?.success && res?.data) return res.data;\n      } catch {}\n      if (code.includes('-')) {\n        const base = code.split('-')[0];\n        try {\n          const res = yield _this4.api.get(`/barcodes/scan?barcode=${encodeURIComponent(base)}`).toPromise();\n          if (res?.success && res?.data) return res.data;\n        } catch {}\n      }\n      try {\n        const m = code.match(/\\/products\\/([a-f0-9]{24})/i);\n        if (m && m[1]) {\n          const prod = yield _this4.productsService.get(m[1]).toPromise();\n          if (prod) return prod;\n        }\n      } catch {}\n      try {\n        const listing = yield _this4.productsService.list({\n          page: 1,\n          limit: 1000\n        }).toPromise();\n        const items = listing?.products || [];\n        const match = items.find(p => String(p.barcode || '').trim() === code || String(p.sku || '').trim() === code);\n        if (match) return yield _this4.productsService.get(match.id).toPromise();\n      } catch {}\n      return null;\n    })();\n  }\n  static {\n    this.ɵfac = function BarcodeScanComponent_Factory(t) {\n      return new (t || BarcodeScanComponent)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.ProductsService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.ToastrService), i0.ɵɵdirectiveInject(i5.WarehouseService), i0.ɵɵdirectiveInject(i6.CatalogService), i0.ɵɵdirectiveInject(i7.StockTransferService));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: BarcodeScanComponent,\n      selectors: [[\"app-barcode-scan\"]],\n      decls: 29,\n      vars: 15,\n      consts: [[1, \"space-y-4\"], [1, \"page-title\"], [1, \"card\", \"p-4\", \"space-y-4\"], [1, \"space-y-2\"], [1, \"label\"], [1, \"flex\", \"items-center\", \"gap-2\"], [1, \"input\", 3, \"ngModelChange\", \"ngModel\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", 3, \"click\", \"disabled\"], [\"type\", \"button\", 1, \"btn\", \"btn-secondary\", 3, \"click\", \"disabled\"], [\"id\", \"qr-reader\", 1, \"mt-2\", \"border\", \"rounded\", \"min-h-[280px]\", \"flex\", \"items-center\", \"justify-center\"], [1, \"text-sm\", \"mt-1\", 3, \"ngClass\"], [4, \"ngIf\"], [1, \"flex\", \"gap-2\"], [\"type\", \"text\", \"placeholder\", \"Scan barcode or enter manually\", \"autofocus\", \"\", 1, \"input\", \"flex-1\", 3, \"ngModelChange\", \"input\", \"ngModel\"], [\"class\", \"btn btn-secondary\", \"type\", \"button\", 3, \"click\", 4, \"ngIf\"], [1, \"text-sm\", \"text-gray-500\", \"mt-1\"], [\"class\", \"flex items-center justify-center py-8\", 4, \"ngIf\"], [\"class\", \"space-y-4\", 4, \"ngIf\"], [\"class\", \"text-center py-8 text-gray-500\", 4, \"ngIf\"], [3, \"value\"], [\"type\", \"button\", 1, \"btn\", \"btn-secondary\", 3, \"click\"], [\"name\", \"x\", 1, \"h-4\", \"w-4\"], [1, \"flex\", \"items-center\", \"justify-center\", \"py-8\"], [1, \"h-8\", \"w-8\"], [1, \"ml-2\", \"text-gray-600\"], [1, \"border-t\", \"pt-4\"], [1, \"text-lg\", \"font-semibold\", \"mb-4\"], [1, \"grid\", \"grid-cols-1\", \"md:grid-cols-2\", \"gap-4\"], [1, \"text-sm\", \"font-medium\", \"text-gray-700\"], [1, \"text-gray-900\", \"font-semibold\"], [1, \"text-gray-600\"], [\"type\", \"number\", \"min\", \"1\", 1, \"input\", 3, \"ngModelChange\", \"ngModel\"], [\"value\", \"\"], [1, \"flex\", \"items-center\", \"gap-4\"], [1, \"inline-flex\", \"items-center\", \"gap-2\"], [\"type\", \"radio\", \"name\", \"transferType\", \"value\", \"warehouse\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"radio\", \"name\", \"transferType\", \"value\", \"store\", 3, \"ngModelChange\", \"ngModel\"], [1, \"flex\", \"gap-2\", \"pt-4\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"text-center\", \"py-8\", \"text-gray-500\"], [1, \"text-sm\", \"mt-2\"]],\n      template: function BarcodeScanComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"h1\", 1);\n          i0.ɵɵtext(2, \"Scan Barcode\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(3, \"div\", 2)(4, \"div\", 3)(5, \"label\", 4);\n          i0.ɵɵtext(6, \"Camera Scanner\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(7, \"div\", 5)(8, \"select\", 6);\n          i0.ɵɵlistener(\"ngModelChange\", function BarcodeScanComponent_Template_select_ngModelChange_8_listener($event) {\n            return ctx.changeCamera($event);\n          });\n          i0.ɵɵtemplate(9, BarcodeScanComponent_option_9_Template, 2, 2, \"option\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(10, \"button\", 8);\n          i0.ɵɵlistener(\"click\", function BarcodeScanComponent_Template_button_click_10_listener() {\n            return ctx.startScanning();\n          });\n          i0.ɵɵtext(11, \"Start Camera\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(12, \"button\", 9);\n          i0.ɵɵlistener(\"click\", function BarcodeScanComponent_Template_button_click_12_listener() {\n            return ctx.stopScanning();\n          });\n          i0.ɵɵtext(13, \"Stop Camera\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelement(14, \"div\", 10);\n          i0.ɵɵelementStart(15, \"div\", 11);\n          i0.ɵɵtemplate(16, BarcodeScanComponent_span_16_Template, 2, 0, \"span\", 12)(17, BarcodeScanComponent_span_17_Template, 2, 0, \"span\", 12);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(18, \"div\")(19, \"label\", 4);\n          i0.ɵɵtext(20, \"Scan or Enter Barcode (Code 128 or QR Code)\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(21, \"div\", 13)(22, \"input\", 14);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function BarcodeScanComponent_Template_input_ngModelChange_22_listener($event) {\n            i0.ɵɵtwoWayBindingSet(ctx.scannedBarcode, $event) || (ctx.scannedBarcode = $event);\n            return $event;\n          });\n          i0.ɵɵlistener(\"input\", function BarcodeScanComponent_Template_input_input_22_listener($event) {\n            return ctx.onBarcodeInput($event.target.value);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(23, BarcodeScanComponent_button_23_Template, 2, 0, \"button\", 15);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(24, \"p\", 16);\n          i0.ɵɵtext(25, \"Supported formats: Code 128, QR Code\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(26, BarcodeScanComponent_div_26_Template, 4, 0, \"div\", 17)(27, BarcodeScanComponent_div_27_Template, 42, 9, \"div\", 18)(28, BarcodeScanComponent_div_28_Template, 7, 1, \"div\", 19);\n          i0.ɵɵelementEnd()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"ngModel\", ctx.cameraId);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngForOf\", ctx.availableCameras);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"disabled\", ctx.scanActive);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"disabled\", !ctx.scanActive);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(12, _c0, !ctx.scanSuccess, ctx.scanSuccess));\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.scanActive && !ctx.scanSuccess);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.scanSuccess);\n          i0.ɵɵadvance(5);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.scannedBarcode);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.scannedBarcode);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.loading);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.product && !ctx.loading);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", !ctx.product && !ctx.loading && ctx.scannedBarcode);\n        }\n      },\n      dependencies: [i8.NgClass, i8.NgForOf, i8.NgIf, i9.NgSelectOption, i9.ɵNgSelectMultipleOption, i9.DefaultValueAccessor, i9.NumberValueAccessor, i9.SelectControlValueAccessor, i9.RadioControlValueAccessor, i9.NgControlStatus, i9.MinValidator, i9.NgModel, i10.SpinnerComponent, i11.LucideIconComponent]\n    });\n  }\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}