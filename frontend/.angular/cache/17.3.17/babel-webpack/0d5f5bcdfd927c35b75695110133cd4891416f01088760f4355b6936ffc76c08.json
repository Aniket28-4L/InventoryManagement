{"ast":null,"code":"import _asyncToGenerator from \"F:/Inventory Management/InventoryManagement/frontend/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nimport { Component } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { ToastrService } from 'ngx-toastr';\nimport { ProductsService } from '../../../core/services/products.service';\nimport { WarehouseService } from '../../../core/services/warehouse.service';\nimport { AuthService } from '../../../core/services/auth.service';\nimport { AlertTriangle, Plus, Edit2 } from 'lucide-angular';\nlet ProductDetailComponent = class ProductDetailComponent {\n  constructor(route, router, productsService, warehouseService, authService, toastr) {\n    this.route = route;\n    this.router = router;\n    this.productsService = productsService;\n    this.warehouseService = warehouseService;\n    this.authService = authService;\n    this.toastr = toastr;\n    this.product = null;\n    this.stock = [];\n    this.warehouses = [];\n    this.loading = true;\n    this.stockLoading = false;\n    this.showAddStockModal = false;\n    this.showAdjustStockModal = false;\n    this.selectedStock = null;\n    this.stockForm = {\n      warehouseId: '',\n      qty: '',\n      locationId: ''\n    };\n    this.AlertTriangle = AlertTriangle;\n    this.Plus = Plus;\n    this.Edit2 = Edit2;\n  }\n  ngOnInit() {\n    const id = this.route.snapshot.paramMap.get('id');\n    if (id) {\n      this.loadProduct(id);\n    }\n  }\n  loadProduct(id) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const token = _this.authService.token;\n      if (!token) return;\n      try {\n        _this.loading = true;\n        const [productRes, stockRes, warehousesRes] = yield Promise.all([_this.productsService.get(id).toPromise(), _this.productsService.stock(id).toPromise().catch(() => []), _this.warehouseService.list({\n          page: 1,\n          limit: 1000\n        }).toPromise()]);\n        _this.product = productRes;\n        _this.stock = stockRes || [];\n        _this.warehouses = warehousesRes?.warehouses || [];\n      } catch (error) {\n        _this.toastr.error(error?.message || 'Failed to load product');\n      } finally {\n        _this.loading = false;\n      }\n    })();\n  }\n  refreshStock() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const id = _this2.route.snapshot.paramMap.get('id');\n      if (!id) return;\n      const token = _this2.authService.getToken();\n      if (!token) return;\n      try {\n        _this2.stockLoading = true;\n        const stockRes = yield _this2.productsService.getProductStock(id).toPromise();\n        _this2.stock = stockRes || [];\n      } catch (error) {\n        console.error('Failed to refresh stock:', error);\n      } finally {\n        _this2.stockLoading = false;\n      }\n    })();\n  }\n  handleAddStock(e) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      e.preventDefault();\n      const id = _this3.route.snapshot.paramMap.get('id');\n      if (!id || !_this3.stockForm.warehouseId || !_this3.stockForm.qty) {\n        _this3.toastr.error('Please fill in warehouse and quantity');\n        return;\n      }\n      const token = _this3.authService.getToken();\n      if (!token) return;\n      try {\n        yield _this3.warehouseService.addStock(id, _this3.stockForm.warehouseId, parseFloat(_this3.stockForm.qty), _this3.stockForm.locationId || null).toPromise();\n        _this3.toastr.success('Stock added successfully');\n        _this3.showAddStockModal = false;\n        _this3.stockForm = {\n          warehouseId: '',\n          qty: '',\n          locationId: ''\n        };\n        yield _this3.refreshStock();\n      } catch (error) {\n        _this3.toastr.error(error?.message || 'Failed to add stock');\n      }\n    })();\n  }\n  handleAdjustStock(e) {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      e.preventDefault();\n      const id = _this4.route.snapshot.paramMap.get('id');\n      if (!id || !_this4.selectedStock || !_this4.stockForm.qty) {\n        _this4.toastr.error('Please enter quantity');\n        return;\n      }\n      const token = _this4.authService.getToken();\n      if (!token) return;\n      try {\n        yield _this4.warehouseService.adjustStock(id, _this4.selectedStock.warehouse?._id || _this4.selectedStock.warehouse, parseFloat(_this4.stockForm.qty), _this4.stockForm.locationId || null).toPromise();\n        _this4.toastr.success('Stock adjusted successfully');\n        _this4.showAdjustStockModal = false;\n        _this4.selectedStock = null;\n        _this4.stockForm = {\n          warehouseId: '',\n          qty: '',\n          locationId: ''\n        };\n        yield _this4.refreshStock();\n      } catch (error) {\n        _this4.toastr.error(error?.message || 'Failed to adjust stock');\n      }\n    })();\n  }\n  openAdjustModal(stockItem) {\n    this.selectedStock = stockItem;\n    this.stockForm = {\n      warehouseId: stockItem.warehouse?._id || stockItem.warehouse,\n      qty: stockItem.qty || 0,\n      locationId: stockItem.location?._id || stockItem.location || ''\n    };\n    this.showAdjustStockModal = true;\n  }\n  get totalStock() {\n    return this.stock.reduce((sum, item) => sum + (item.qty || 0), 0);\n  }\n  get totalAvailable() {\n    return this.stock.reduce((sum, item) => sum + (item.availableQty || 0), 0);\n  }\n  get hasZeroStock() {\n    return this.totalStock === 0;\n  }\n  get hasLowStock() {\n    return this.totalStock > 0 && this.totalAvailable === 0;\n  }\n};\nProductDetailComponent = __decorate([Component({\n  selector: 'app-product-detail',\n  templateUrl: './product-detail.component.html',\n  styleUrls: ['./product-detail.component.scss']\n}), __metadata(\"design:paramtypes\", [ActivatedRoute, Router, ProductsService, WarehouseService, AuthService, ToastrService])], ProductDetailComponent);\nexport { ProductDetailComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}