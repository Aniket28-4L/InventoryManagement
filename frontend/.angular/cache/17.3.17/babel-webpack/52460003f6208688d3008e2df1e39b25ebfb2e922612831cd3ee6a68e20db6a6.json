{"ast":null,"code":"import _asyncToGenerator from \"F:/REACT PROJECT/IM/IM/InventoryManagement/frontend/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ToastrService } from 'ngx-toastr';\nimport { ProductsService } from '../../../core/services/products.service';\nimport * as XLSX from 'xlsx';\nimport { parse } from 'papaparse';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-toastr\";\nimport * as i2 from \"../../../core/services/products.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"../../../shared/components/file-uploader/file-uploader.component\";\nfunction ProductImportComponent_th_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 13);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const key_r1 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(key_r1);\n  }\n}\nfunction ProductImportComponent_tr_14_td_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const key_r2 = ctx.$implicit;\n    const row_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(row_r3[key_r2]);\n  }\n}\nfunction ProductImportComponent_tr_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\", 14);\n    i0.ɵɵtemplate(1, ProductImportComponent_tr_14_td_1_Template, 2, 1, \"td\", 15);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.getKeys());\n  }\n}\nfunction ProductImportComponent_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 17);\n    i0.ɵɵtext(1, \"No data loaded.\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport class ProductImportComponent {\n  constructor(toastr, productsService) {\n    this.toastr = toastr;\n    this.productsService = productsService;\n    this.rows = [];\n    this.selectedFile = null;\n  }\n  onFilesSelected(files) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const file = files[0];\n      if (!file) return;\n      _this.selectedFile = file;\n      if (file.name.endsWith('.csv')) {\n        parse(file, {\n          header: true,\n          complete: res => {\n            _this.rows = res.data.filter(Boolean);\n          }\n        });\n      } else {\n        const buf = yield file.arrayBuffer();\n        const wb = XLSX.read(buf, {\n          type: 'array'\n        });\n        const ws = wb.Sheets[wb.SheetNames[0]];\n        const data = XLSX.utils.sheet_to_json(ws);\n        _this.rows = data;\n      }\n    })();\n  }\n  importData() {\n    if (!this.selectedFile) {\n      this.toastr.error('Please select a CSV or Excel file');\n      return;\n    }\n    // Upload the original file to backend\n    // Backend parses CSV/XLSX and inserts products\n    this.productsService.import(this.selectedFile).subscribe({\n      next: inserted => {\n        this.toastr.success(`Imported ${inserted} products successfully`);\n      },\n      error: err => {\n        const msg = err?.error?.message || err?.message || 'Failed to import products';\n        this.toastr.error(msg);\n      }\n    });\n  }\n  getKeys() {\n    return this.rows[0] ? Object.keys(this.rows[0]) : [];\n  }\n  static {\n    this.ɵfac = function ProductImportComponent_Factory(t) {\n      return new (t || ProductImportComponent)(i0.ɵɵdirectiveInject(i1.ToastrService), i0.ɵɵdirectiveInject(i2.ProductsService));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ProductImportComponent,\n      selectors: [[\"app-product-import\"]],\n      decls: 16,\n      vars: 3,\n      consts: [[1, \"space-y-4\"], [1, \"flex\", \"items-center\", \"justify-between\"], [1, \"page-title\"], [1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"card\", \"p-4\", \"space-y-4\"], [\"label\", \"CSV or Excel\", \"accept\", \".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel\", 3, \"filesSelected\"], [1, \"overflow-x-auto\"], [1, \"min-w-full\", \"divide-y\", \"divide-gray-200\"], [1, \"bg-gray-50\"], [\"class\", \"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase\", 4, \"ngFor\", \"ngForOf\"], [1, \"divide-y\", \"divide-gray-100\"], [\"class\", \"hover:bg-gray-50\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"text-sm text-gray-500 p-2\", 4, \"ngIf\"], [1, \"px-4\", \"py-2\", \"text-left\", \"text-xs\", \"font-medium\", \"text-gray-500\", \"uppercase\"], [1, \"hover:bg-gray-50\"], [\"class\", \"px-4 py-2 text-sm\", 4, \"ngFor\", \"ngForOf\"], [1, \"px-4\", \"py-2\", \"text-sm\"], [1, \"text-sm\", \"text-gray-500\", \"p-2\"]],\n      template: function ProductImportComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h1\", 2);\n          i0.ɵɵtext(3, \"Import Products\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"button\", 3);\n          i0.ɵɵlistener(\"click\", function ProductImportComponent_Template_button_click_4_listener() {\n            return ctx.importData();\n          });\n          i0.ɵɵtext(5, \"Import\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(6, \"div\", 4)(7, \"app-file-uploader\", 5);\n          i0.ɵɵlistener(\"filesSelected\", function ProductImportComponent_Template_app_file_uploader_filesSelected_7_listener($event) {\n            return ctx.onFilesSelected($event);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(8, \"div\", 6)(9, \"table\", 7)(10, \"thead\", 8)(11, \"tr\");\n          i0.ɵɵtemplate(12, ProductImportComponent_th_12_Template, 2, 1, \"th\", 9);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(13, \"tbody\", 10);\n          i0.ɵɵtemplate(14, ProductImportComponent_tr_14_Template, 2, 1, \"tr\", 11);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(15, ProductImportComponent_div_15_Template, 2, 0, \"div\", 12);\n          i0.ɵɵelementEnd()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(12);\n          i0.ɵɵproperty(\"ngForOf\", ctx.getKeys());\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.rows.slice(0, 50));\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.rows.length === 0);\n        }\n      },\n      dependencies: [i3.NgForOf, i3.NgIf, i4.FileUploaderComponent]\n    });\n  }\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}