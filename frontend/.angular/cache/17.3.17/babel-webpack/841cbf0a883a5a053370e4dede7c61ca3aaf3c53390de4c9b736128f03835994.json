{"ast":null,"code":"import { ToastrService } from 'ngx-toastr';\nimport { ProductsService } from '../../../core/services/products.service';\nimport { ApiService } from '../../../core/services/api.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../core/services/products.service\";\nimport * as i2 from \"../../../core/services/api.service\";\nimport * as i3 from \"ngx-toastr\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"../../../shared/components/barcode-preview/barcode-preview.component\";\nfunction BarcodeGenerateComponent_option_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 6);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const product_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", product_r1);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\"\", product_r1.name, \" (\", product_r1.sku, \")\");\n  }\n}\nfunction BarcodeGenerateComponent_div_16_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 17);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const val_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", val_r4);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(val_r4);\n  }\n}\nfunction BarcodeGenerateComponent_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"label\", 4);\n    i0.ɵɵtext(2, \"Variant Value\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"select\", 14);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function BarcodeGenerateComponent_div_16_Template_select_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r2.selectedVariantValue, $event) || (ctx_r2.selectedVariantValue = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementStart(4, \"option\", 15);\n    i0.ɵɵtext(5, \"Select value\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, BarcodeGenerateComponent_div_16_option_6_Template, 2, 2, \"option\", 16);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r2.selectedVariantValue);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.variantValues());\n  }\n}\nfunction BarcodeGenerateComponent_button_20_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function BarcodeGenerateComponent_button_20_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.saveBarcodeToProduct());\n    });\n    i0.ɵɵtext(1, \"Save to Product\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BarcodeGenerateComponent_div_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 19)(1, \"h2\", 20);\n    i0.ɵɵtext(2, \"Generated Barcodes\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 21)(4, \"div\", 22);\n    i0.ɵɵelement(5, \"app-barcode-preview\", 23);\n    i0.ɵɵelementStart(6, \"p\", 24);\n    i0.ɵɵtext(7, \"Code 128\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 22);\n    i0.ɵɵelement(9, \"app-barcode-preview\", 25);\n    i0.ɵɵelementStart(10, \"p\", 24);\n    i0.ɵɵtext(11, \"QR Code\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"p\", 26);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"value\", ctx_r2.generatedBarcode);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"value\", ctx_r2.getQrCodeValue());\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"Barcode Value: \", ctx_r2.generatedBarcode, \"\");\n  }\n}\nexport class BarcodeGenerateComponent {\n  constructor(productsService, api, toastr) {\n    this.productsService = productsService;\n    this.api = api;\n    this.toastr = toastr;\n    this.products = [];\n    this.selectedProduct = null;\n    this.barcodeType = 'code128';\n    this.barcodeValue = '';\n    this.loading = false;\n    this.generatedBarcode = '';\n    this.selectedVariantValue = '';\n  }\n  ngOnInit() {\n    this.loadProducts();\n  }\n  loadProducts() {\n    this.loading = true;\n    this.productsService.list({\n      page: 1,\n      limit: 1000\n    }).subscribe({\n      next: res => {\n        this.products = res.products;\n        this.loading = false;\n      },\n      error: () => {\n        this.toastr.error('Failed to load products');\n        this.loading = false;\n      }\n    });\n  }\n  onProductSelect() {\n    if (this.selectedProduct) {\n      // Use product's barcode value, fallback to SKU\n      this.barcodeValue = this.selectedProduct.barcode || this.selectedProduct.sku || '';\n      // If product doesn't have PDF URL, fetch full product details\n      if (!this.selectedProduct.pdfUrl) {\n        this.productsService.get(this.selectedProduct.id).subscribe({\n          next: product => {\n            this.selectedProduct = product;\n            const values = this.variantValues();\n            this.selectedVariantValue = values[0] || this.selectedProduct.variantValue || '';\n            this.generateBarcode();\n          },\n          error: () => {\n            const values = this.variantValues();\n            this.selectedVariantValue = values[0] || this.selectedProduct.variantValue || '';\n            this.generateBarcode();\n          }\n        });\n      } else {\n        const values = this.variantValues();\n        this.selectedVariantValue = values[0] || this.selectedProduct.variantValue || '';\n        this.generateBarcode();\n      }\n    }\n  }\n  variantValues() {\n    const list = Array.isArray(this.selectedProduct?.variants) ? this.selectedProduct.variants : [];\n    const values = list.map(e => String(e?.value || '')).filter(Boolean);\n    if (values.length === 0 && this.selectedProduct?.variantValue) {\n      values.push(String(this.selectedProduct.variantValue));\n    }\n    return values;\n  }\n  deriveBarcodeValue(value) {\n    const list = Array.isArray(this.selectedProduct?.variants) ? this.selectedProduct.variants : [];\n    const match = list.find(e => String(e?.value || '') === String(value || ''));\n    const base = match?.barcode || match?.sku || this.selectedProduct?.barcode || this.selectedProduct?.sku || '';\n    if (!base) return '';\n    const isProductLevel = base === this.selectedProduct?.barcode || base === this.selectedProduct?.sku;\n    return isProductLevel ? `${base}-${value}` : base;\n  }\n  generateBarcode() {\n    const fromInput = String(this.barcodeValue || '').trim();\n    let value = fromInput;\n    if (this.selectedProduct) {\n      const v = String(this.selectedVariantValue || '').trim();\n      value = v ? this.deriveBarcodeValue(v) : this.selectedProduct.barcode || this.selectedProduct.sku || fromInput;\n    }\n    if (!value) {\n      this.toastr.error('Please select a product and variant value or enter a barcode');\n      return;\n    }\n    this.generatedBarcode = value;\n  }\n  getQrCodeValue() {\n    const origin = window.location.origin;\n    const payload = String(this.generatedBarcode || this.barcodeValue || this.selectedProduct?.sku || '').trim();\n    return payload ? `${origin}/stock/transfer?sku=${encodeURIComponent(payload)}` : `${origin}/stock/transfer`;\n  }\n  saveBarcodeToProduct() {\n    if (!this.selectedProduct || !this.barcodeValue) {\n      this.toastr.error('Please select a product and enter a barcode');\n      return;\n    }\n    this.productsService.update(this.selectedProduct.id, {\n      barcode: this.barcodeValue\n    }, []).subscribe({\n      next: () => {\n        this.toastr.success('Barcode saved to product');\n        this.loadProducts();\n      },\n      error: () => {\n        this.toastr.error('Failed to save barcode');\n      }\n    });\n  }\n  static {\n    this.ɵfac = function BarcodeGenerateComponent_Factory(t) {\n      return new (t || BarcodeGenerateComponent)(i0.ɵɵdirectiveInject(i1.ProductsService), i0.ɵɵdirectiveInject(i2.ApiService), i0.ɵɵdirectiveInject(i3.ToastrService));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: BarcodeGenerateComponent,\n      selectors: [[\"app-barcode-generate\"]],\n      decls: 22,\n      vars: 8,\n      consts: [[1, \"space-y-4\"], [1, \"page-title\"], [1, \"grid\", \"grid-cols-1\", \"lg:grid-cols-2\", \"gap-4\"], [1, \"card\", \"p-4\", \"space-y-4\"], [1, \"label\"], [1, \"input\", 3, \"ngModelChange\", \"change\", \"ngModel\", \"disabled\"], [3, \"ngValue\"], [3, \"ngValue\", 4, \"ngFor\", \"ngForOf\"], [\"placeholder\", \"Enter barcode value\", 1, \"input\", 3, \"ngModelChange\", \"ngModel\"], [4, \"ngIf\"], [1, \"flex\", \"gap-2\"], [1, \"btn\", \"btn-primary\", 3, \"click\"], [\"class\", \"btn btn-secondary\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"card p-4\", 4, \"ngIf\"], [1, \"input\", 3, \"ngModelChange\", \"ngModel\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"value\"], [1, \"btn\", \"btn-secondary\", 3, \"click\"], [1, \"card\", \"p-4\"], [1, \"text-lg\", \"font-semibold\", \"mb-4\"], [1, \"flex\", \"flex-col\", \"items-center\", \"justify-center\", \"gap-6\", \"p-8\", \"border-2\", \"border-dashed\", \"border-gray-300\", \"rounded-lg\"], [1, \"flex\", \"flex-col\", \"items-center\", \"gap-2\"], [\"type\", \"code128\", 3, \"value\"], [1, \"text-sm\", \"text-gray-600\"], [\"type\", \"qr\", 3, \"value\"], [1, \"mt-4\", \"text-sm\", \"text-gray-600\", \"font-medium\"]],\n      template: function BarcodeGenerateComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"h1\", 1);\n          i0.ɵɵtext(2, \"Generate Barcode\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(3, \"div\", 2)(4, \"div\", 3)(5, \"div\")(6, \"label\", 4);\n          i0.ɵɵtext(7, \"Select Product\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(8, \"select\", 5);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function BarcodeGenerateComponent_Template_select_ngModelChange_8_listener($event) {\n            i0.ɵɵtwoWayBindingSet(ctx.selectedProduct, $event) || (ctx.selectedProduct = $event);\n            return $event;\n          });\n          i0.ɵɵlistener(\"change\", function BarcodeGenerateComponent_Template_select_change_8_listener() {\n            return ctx.onProductSelect();\n          });\n          i0.ɵɵelementStart(9, \"option\", 6);\n          i0.ɵɵtext(10, \"Select a product\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(11, BarcodeGenerateComponent_option_11_Template, 2, 3, \"option\", 7);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(12, \"div\")(13, \"label\", 4);\n          i0.ɵɵtext(14, \"Barcode Value\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(15, \"input\", 8);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function BarcodeGenerateComponent_Template_input_ngModelChange_15_listener($event) {\n            i0.ɵɵtwoWayBindingSet(ctx.barcodeValue, $event) || (ctx.barcodeValue = $event);\n            return $event;\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(16, BarcodeGenerateComponent_div_16_Template, 7, 2, \"div\", 9);\n          i0.ɵɵelementStart(17, \"div\", 10)(18, \"button\", 11);\n          i0.ɵɵlistener(\"click\", function BarcodeGenerateComponent_Template_button_click_18_listener() {\n            return ctx.generateBarcode();\n          });\n          i0.ɵɵtext(19, \"Generate\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(20, BarcodeGenerateComponent_button_20_Template, 2, 0, \"button\", 12);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(21, BarcodeGenerateComponent_div_21_Template, 14, 3, \"div\", 13);\n          i0.ɵɵelementEnd()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(8);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.selectedProduct);\n          i0.ɵɵproperty(\"disabled\", ctx.loading);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngValue\", null);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.products);\n          i0.ɵɵadvance(4);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.barcodeValue);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.selectedProduct);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngIf\", ctx.selectedProduct);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.generatedBarcode);\n        }\n      },\n      dependencies: [i4.NgForOf, i4.NgIf, i5.NgSelectOption, i5.ɵNgSelectMultipleOption, i5.DefaultValueAccessor, i5.SelectControlValueAccessor, i5.NgControlStatus, i5.NgModel, i6.BarcodePreviewComponent]\n    });\n  }\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}