{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nimport { Component } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { ToastrService } from 'ngx-toastr';\nimport { Subject } from 'rxjs';\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { ProductsService } from '../../../core/services/products.service';\nlet ProductsListComponent = class ProductsListComponent {\n  constructor(productsService, toastr, router, route) {\n    this.productsService = productsService;\n    this.toastr = toastr;\n    this.router = router;\n    this.route = route;\n    this.products = [];\n    this.page = 1;\n    this.pageSize = 10;\n    this.total = 0;\n    this.loading = true;\n    this.exporting = false;\n    this.searchTerm = '';\n    this.deleteTarget = null;\n    this.searchSubject = new Subject();\n  }\n  ngOnInit() {\n    // Set up debounced search\n    this.searchSubscription = this.searchSubject.pipe(debounceTime(300), distinctUntilChanged()).subscribe(searchTerm => {\n      this.page = 1;\n      this.fetchProducts(1);\n    });\n    // Handle initial query params\n    this.queryParamsSubscription = this.route.queryParams.subscribe(params => {\n      if (params['q']) {\n        this.searchTerm = params['q'];\n        this.searchSubject.next(this.searchTerm);\n      } else {\n        this.fetchProducts();\n      }\n    });\n  }\n  ngOnDestroy() {\n    this.searchSubscription?.unsubscribe();\n    this.queryParamsSubscription?.unsubscribe();\n  }\n  get totalPages() {\n    return Math.max(1, Math.ceil(this.total / this.pageSize));\n  }\n  fetchProducts(page = this.page) {\n    this.loading = true;\n    const params = {\n      page,\n      limit: this.pageSize\n    };\n    if (this.searchTerm && this.searchTerm.trim()) {\n      params.q = this.searchTerm.trim();\n    }\n    this.productsService.list(params).subscribe({\n      next: res => {\n        this.products = res.products;\n        this.page = res.page;\n        this.total = res.total;\n        this.loading = false;\n      },\n      error: () => {\n        this.toastr.error('Failed to load products');\n        this.loading = false;\n      }\n    });\n  }\n  onSearchInput(value) {\n    this.searchTerm = value;\n    this.searchSubject.next(value);\n  }\n  clearSearch() {\n    this.searchTerm = '';\n    this.searchSubject.next('');\n    this.page = 1;\n    this.fetchProducts(1);\n  }\n  search() {\n    this.page = 1;\n    this.fetchProducts(1);\n  }\n  openDelete(product) {\n    this.deleteTarget = product;\n  }\n  closeDelete() {\n    this.deleteTarget = null;\n  }\n  confirmDelete() {\n    if (!this.deleteTarget) return;\n    this.productsService.delete(this.deleteTarget.id).subscribe({\n      next: () => {\n        this.toastr.success('Product deleted successfully');\n        this.closeDelete();\n        this.fetchProducts(this.page);\n      },\n      error: () => {\n        this.toastr.error('Failed to delete product');\n      }\n    });\n  }\n  export() {\n    if (this.exporting) {\n      return;\n    }\n    this.exporting = true;\n    const params = {};\n    if (this.searchTerm && this.searchTerm.trim()) {\n      params.q = this.searchTerm.trim();\n    }\n    this.productsService.exportXlsx(params).subscribe({\n      next: res => {\n        try {\n          const byteCharacters = atob(res.base64);\n          const byteNumbers = new Array(byteCharacters.length);\n          for (let i = 0; i < byteCharacters.length; i++) {\n            byteNumbers[i] = byteCharacters.charCodeAt(i);\n          }\n          const byteArray = new Uint8Array(byteNumbers);\n          const blob = new Blob([byteArray], {\n            type: res.mime || 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n          });\n          const url = window.URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = res.filename || 'products.xlsx';\n          document.body.appendChild(a);\n          a.click();\n          window.URL.revokeObjectURL(url);\n          document.body.removeChild(a);\n          this.toastr.success('Products exported successfully');\n        } catch (e) {\n          console.error('Failed to download export file:', e);\n          this.toastr.error('Failed to download export file');\n        } finally {\n          this.exporting = false;\n        }\n      },\n      error: err => {\n        console.error('Export failed:', err);\n        this.toastr.error('Failed to export products');\n        this.exporting = false;\n      }\n    });\n  }\n  goTo(page) {\n    if (page < 1 || page === this.page) return;\n    this.page = page;\n    this.fetchProducts(page);\n  }\n  next() {\n    if (this.page * this.pageSize >= this.total) return;\n    this.goTo(this.page + 1);\n  }\n  prev() {\n    if (this.page === 1) return;\n    this.goTo(this.page - 1);\n  }\n  exportProducts() {\n    this.productsService.exportXlsx().subscribe({\n      next: ({\n        filename,\n        mime,\n        base64\n      }) => {\n        const link = document.createElement('a');\n        link.href = `data:${mime};base64,${base64}`;\n        link.download = filename || 'products.xlsx';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        this.toastr.success('Products exported');\n      },\n      error: err => {\n        const msg = err?.error?.message || err?.message || 'Failed to export products';\n        this.toastr.error(msg);\n      }\n    });\n  }\n};\nProductsListComponent = __decorate([Component({\n  selector: 'app-products-list',\n  templateUrl: './products-list.component.html',\n  styleUrls: ['./products-list.component.scss']\n}), __metadata(\"design:paramtypes\", [ProductsService, ToastrService, Router, ActivatedRoute])], ProductsListComponent);\nexport { ProductsListComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}