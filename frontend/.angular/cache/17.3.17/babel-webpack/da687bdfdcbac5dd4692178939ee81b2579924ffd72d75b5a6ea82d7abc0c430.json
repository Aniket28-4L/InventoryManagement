{"ast":null,"code":"import { map } from 'rxjs';\nimport { ApiService } from './api.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./api.service\";\nexport class ProductsService {\n  constructor(api) {\n    this.api = api;\n  }\n  list(params) {\n    return this.api.get('/products', params).pipe(map(res => ({\n      products: (res.data || res.products || []).map(this.mapProduct),\n      page: res.page || params['page'] || 1,\n      total: res.total || res.data?.length || 0,\n      pages: res.pages || 0\n    })));\n  }\n  get(id) {\n    return this.api.get(`/products/${id}`).pipe(map(res => this.mapProduct(res.data)));\n  }\n  create(payload, images) {\n    const formData = this.buildFormData(payload, images);\n    return this.api.post('/products', formData, {\n      headers: {\n        'enctype': 'multipart/form-data'\n      }\n    }).pipe(map(res => this.mapProduct(res.data)));\n  }\n  update(id, payload, images) {\n    const formData = this.buildFormData(payload, images);\n    return this.api.put(`/products/${id}`, formData).pipe(map(res => this.mapProduct(res.data)));\n  }\n  delete(id) {\n    return this.api.delete(`/products/${id}`).pipe(map(res => res.success !== false));\n  }\n  import(file) {\n    const formData = new FormData();\n    formData.append('file', file);\n    return this.api.post('/products/import', formData);\n  }\n  exportXlsx(params) {\n    return this.api.get('/products/export/xlsx', params);\n  }\n  stock(id) {\n    return this.api.get(`/products/${id}/stock`).pipe(map(res => res.data || []));\n  }\n  buildFormData(payload, images) {\n    const formData = new FormData();\n    Object.entries(payload).forEach(([key, value]) => {\n      if (value === undefined || value === null || value === '') return;\n      formData.append(key, value);\n    });\n    images.forEach(file => formData.append('images', file));\n    return formData;\n  }\n  mapProduct(product) {\n    if (!product) return product;\n    const {\n      _id,\n      ...rest\n    } = product;\n    const mapped = {\n      id: _id || product.id,\n      ...rest\n    };\n    // Normalise populated references to IDs for form usage\n    if (mapped.category && typeof mapped.category === 'object') {\n      mapped.category = mapped.category._id;\n    }\n    if (mapped.brand && typeof mapped.brand === 'object') {\n      mapped.brand = mapped.brand._id;\n    }\n    if (mapped.variant && typeof mapped.variant === 'object') {\n      mapped.variant = mapped.variant._id;\n    }\n    if (mapped.supplier && typeof mapped.supplier === 'object') {\n      mapped.supplier = mapped.supplier._id;\n    }\n    return mapped;\n  }\n  static {\n    this.ɵfac = function ProductsService_Factory(t) {\n      return new (t || ProductsService)(i0.ɵɵinject(i1.ApiService));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: ProductsService,\n      factory: ProductsService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}